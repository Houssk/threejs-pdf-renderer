<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf8">
		<title>A simple jsPDF test</title>
		<!--
		+	
		+	Simple example testing jsPDF and output to iframe ...
		+
		L + + + + + + + + + + + + + + + + + + -->
		<script src="../../external/jspdf/dist/jspdf.min.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="page" style="width:900px;margin:20px auto">
		<script type="text/javascript">
			window.onload = function () {
				
				var iframe = document.createElement('iframe');
				iframe.setAttribute('type', 'application/pdf'); // need this?
				iframe.setAttribute('width',  '100%');
				iframe.setAttribute('height', 600);
				iframe.setAttribute('style', 'border:0px solid transparent !important');

				document.getElementById('page').appendChild(iframe);
				
				var doc = new jsPDF('landscape','pt', 'a4');

				doc.setTextColor( 120 );
				doc.text( 20, 40, 'Hello world!');

				doc.setDrawColor( 255,0,255 );
				doc.setFillColor( 255,255,0 );

				doc.lines( new ShapeRecorder().vertex(0,0).vertex(110,0).vertex(110,110).vertex(0,110).close().toLines(), 
						   100, 100, [1,1], 'FD' ); // filled, outlined

				doc.triangle( 500, 100, 540, 100, 520, 140, 'F' ); // fill only
				doc.triangle( 520, 120, 560, 120, 540, 160, 'S' ); // outline only

				iframe.src = doc.output('datauristring');
			}

			/**
			 *	Faking some beginShape() ... endShape() functionality. I miss Processing.
			 */
			var ShapeRecorder = function () {
				this.position;
				this.recorder;
				this.vertex = function ( x, y ) {
					if ( !this.position ) {
						this.recorder= [[x,y]];
						this.position = [x,y];
					} else {
						this.recorder.push([x-this.position[0],y-this.position[1]]);
					}
					this.position[0] = x;
					this.position[1] = y;
					return this;
				}
				// TODO: not tested, needs fixing
				// this.bezierVertex = function ( hx1, hy1, hx2, hy2, x2, y2 ) {
				// 	if ( !this.position ) {
				// 		this.position = [0,0];
				// 	}

				// 	var nextPos = [x2-this.position[0], y2-this.position[1]];
				// 	this.recorder.push([ this.position[0]-hx1, this.position[1]-hy1,
				// 						 this.position[0]-hx2, this.position[1]-hy2,
				// 						 nextPos[0],  nextPos[1] ]);
				// 	this.position = nextPos;
				// 	return this;
				// }
				this.close = function () {
					this.recorder.push([this.recorder[0][0]-this.position[0], this.recorder[0][1]-this.position[1]]);
					return this;
				}
				this.toLines = function () {
					console.log( this.recorder );
					return this.recorder;
				}
			}
		</script>
		</div>
	</body>
</html>